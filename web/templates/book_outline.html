<!-- web/templates/book_outline.html -->
{% extends "base.html" %}

{% block content %}
<input type="hidden" name="book_id" value="{{ book.id }}">
<h2>{{ book.title }}</h2>
<p>{{ book.premise }}</p>

<table class="table table-bordered">
  <thead class="table-light">
    <tr>
      <th>–ì–ª–∞–≤–∞</th>
      <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
      <th>–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</th>
      {% for sl in storylines %}
      <th>{{ sl }}</th>
      {% endfor %}
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>
  <tbody>
    {% for ch in chapters %}
    <tr>
      <td>{{ ch.Chapter }}</td>
      <td>{{ ch.Title }}</td>
      <td>
        {% if ch.Generate == "‚úÖ" %}
          <input 
            type="checkbox" 
            hx-post="/toggle-chapter" 
            hx-include="[name=book_id]" 
            hx-vals='{"chapter_num": {{ ch.Chapter }}, "enabled": false}' 
            hx-swap="outerHTML" 
            checked
          >
        {% else %}
          <input 
            type="checkbox" 
            hx-post="/toggle-chapter" 
            hx-include="[name=book_id]" 
            hx-vals='{"chapter_num": {{ ch.Chapter }}, "enabled": true}' 
            hx-swap="outerHTML"
          >
        {% endif %}
      </td>
      {% for sl in storylines %}
      <td>{{ ch[sl] }}</td>
      {% endfor %}
      <td>
        {% if ch.Content %}
          <a href="/chapter/{{ book.id }}/{{ ch.Chapter }}" class="btn btn-sm btn-outline-primary">–ß–∏—Ç–∞—Ç—å</a>
        {% else %}
          <span class="text-muted">‚Äî</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="mt-3">
  <button 
    hx-post="/generate-chapters" 
    hx-confirm="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ –≥–ª–∞–≤—ã?" 
    hx-target="#result" 
    hx-swap="beforeend"
    class="btn btn-success"
  >
    üìö –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥–ª–∞–≤—ã
  </button>
  <div class="htmx-indicator mt-2">‚è≥ –ò–¥—ë—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–ª–∞–≤...</div>
</div>
<div id="result"></div>

</div>
{% endblock %}